machine:
  services:
    - docker

dependencies:
  override:
    - $(aws ecr get-login --region us-east-2)
    - docker build -t ecrtest .

test:
  override:
    ## put your test command here
    ## - docker run -e RAILS_ENV=test -it my-website rake test

general:
  build_dir: node
  
deployment:
  hub:
    branch: master ## do deployment on commit to the master branch only 
    commands:
      - docker tag ecrtest 878242495038.dkr.ecr.us-east-2.amazonaws.com/ecs_test:$CIRCLE_SHA1
      - docker tag ecrtest 878242495038.dkr.ecr.us-east-2.amazonaws.com/ecs_test:latest
      - docker push 878242495038.dkr.ecr.us-east-2.amazonaws.com/ecs_test:$CIRCLE_SHA
      - docker push 878242495038.dkr.ecr.us-east-2.amazonaws.com/ecs_test:latest
      - ls
      - bash ./node_deployment_check.sh